# SolidWorks BOM自动化处理系统 - 部署说明

**当前稳定版本：v1.0（2025-09-02）**

## 系统要求

### 硬件要求
- Windows 10 专业版（推荐）
- 内存：至少 8GB RAM
- 硬盘：至少 100MB 可用空间

### 软件要求
- **SolidWorks 2019** 或更高版本
- **.NET Framework 4.5** 或更高版本
- **Excel 2016**（可选，系统会使用SolidWorks内置Excel导出功能）

## 部署步骤

### 方法零：从GitHub获取（推荐）

1. **克隆或下载项目**
   - 访问项目GitHub仓库
   - 使用git克隆：`git clone https://github.com/YOUR_USERNAME/ExportNestedBOM.git`
   - 或直接下载ZIP压缩包

2. **使用预编译宏文件**
   - 直接使用 `src/ExportNestedBOM.swp` 文件
   - 在SolidWorks中：工具 > 宏 > 运行...
   - 选择下载的 `ExportNestedBOM.swp` 文件

### 方法一：通过SolidWorks宏编辑器部署

1. **打开SolidWorks**
   - 启动SolidWorks 2019
   - 确保程序完全加载

2. **打开宏编辑器**
   - 菜单：工具 > 宏 > 编辑...
   - 或按快捷键：Alt + F11

3. **创建新宏项目**
   - 在VBA编辑器中，右键点击"VBAProject"
   - 选择"插入" > "模块"

4. **导入源码文件**
   按顺序导入以下文件（复制粘贴代码内容）：
   ```
   src/Constants.bas      -> 模块1
   src/Configuration.bas  -> 模块2  
   src/Logger.bas        -> 模块3
   src/Utils.bas         -> 模块4
   src/RecursiveProcessor.bas -> 模块5
   src/Main.bas          -> 模块6
   ```

5. **保存宏项目**
   - 文件 > 保存
   - 建议保存为：`ExportNestedBOM.swp`

### 方法二：直接导入宏文件

1. **复制宏文件**
   - 将 `src/ExportNestedBOM.swp` 复制到SolidWorks宏目录
   - 默认位置：`%USERPROFILE%\Documents\SOLIDWORKS\Macros\`

2. **运行宏**
   - SolidWorks菜单：工具 > 宏 > 运行...
   - 选择 `ExportNestedBOM.swp`
   - 执行 `RunExportNestedBOM` 函数

## 配置验证

### 1. 测试SolidWorks API连接
```vba
' 在SolidWorks VBA编辑器中执行以下代码进行测试
Sub TestConnection()
    Dim swApp As Object
    Set swApp = Application.SldWorks
    If swApp Is Nothing Then
        MsgBox "无法连接到SolidWorks"
    Else
        MsgBox "SolidWorks连接成功，版本：" & swApp.RevisionNumber
    End If
End Sub
```

### 2. 验证文件权限
确保以下目录具有读写权限：
- 工程图文件所在目录
- 系统临时目录：`%TEMP%`
- SolidWorks安装目录

## 使用前准备

### 1. 文件结构要求
```
项目文件夹/
├── 顶层装配体.slddrw       (必需)
├── 子装配体1.slddrw        (如有子装配体)
├── 子装配体2.slddrw        (如有子装配体)
└── 零件文件.sldprt         (可选)
```

### 2. BOM表格式要求
- 工程图必须包含**BOM表**
- BOM表必须包含以下列（列名支持中英文）：
  - **数量列**："数量", "QTY", "Qty"
  - **零件号列**："代号", "PART NUMBER", "Part Number"
  - **名称列**："名称", "PART NAME", "Name"
  - **是否组装列**："是否组装", "Is Assembly"（位于最右侧）

### 3. "是否组装"列标记规范
- **组装体**：填写 "是", "Y", "YES", "TRUE", "1"
- **零件**：填写 "否", "N", "NO", "FALSE", "0" 或留空

## 故障排除

### 常见问题及解决方案

#### 1. "无法连接到SolidWorks应用程序"
**原因**：SolidWorks未启动或API连接失败
**解决方案**：
- 确保SolidWorks完全启动
- 重启SolidWorks
- 检查SolidWorks版本兼容性

#### 2. "未找到BOM表"
**原因**：工程图中没有BOM表或BOM表格式不正确
**解决方案**：
- 在工程图中插入BOM表
- 检查BOM表是否包含必需的列
- 确保BOM表不是空表

#### 3. "循环引用检测"
**原因**：装配体结构中存在循环引用
**解决方案**：
- 检查装配体结构
- 消除循环引用
- 重新组织装配体层次

#### 4. "文件写入权限不足"
**原因**：目标目录没有写权限
**解决方案**：
- 以管理员身份运行SolidWorks
- 检查目录权限设置
- 更换输出目录

### 日志文件位置
- 默认位置：工程图同目录下的 `*_run.log` 文件
- 备用位置：`%TEMP%\ExportNestedBOM_*.log`

## 性能优化建议

### 1. 大型装配体处理
- 建议递归深度不超过8层
- 关闭不必要的SolidWorks插件
- 确保充足的内存和硬盘空间

### 2. 批量处理优化
- 按装配体大小分批处理
- 定期清理临时文件
- 监控系统资源使用情况

## 技术支持

### 联系方式
- 项目文档：`README.md`
- 测试指南：`test/测试指南.md`
- 日志分析：查看 `*_run.log` 文件

### 版本信息
- 当前版本：1.0.0
- 支持的SolidWorks版本：2019+
- 最后更新：2024年

## v1.0版本更新说明

### 新特性与改进
- 修复生产环境汇总表中文乱码问题（HTML输出编码改为gb2312）
- 支持"代号 名称.slddrw"格式的工程图文件查找
- BOM列识别支持"零件号"作为代号列关键词
- 优化错误处理和日志记录

### 升级注意事项
- 从旧版本升级时，请完整替换所有源码文件
- 升级后首次运行建议在测试环境验证功能
- 如有自定义修改，请注意合并您的更改