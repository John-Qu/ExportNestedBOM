# 测试指南

## 测试环境设置

### 准备工作
1. 确保Windows虚拟机已安装SolidWorks 2019
2. 准备测试文件（基于用户提供的实际案例）：
   - `TS180-01Z-01Z四柱平台.slddrw`（顶层装配体工程图）
   - `TS180-01Z-02Z立柱平台.slddrw`（子装配体工程图）

### 测试数据结构分析

#### 顶层装配体BOM
```
项目号 | PART NUMBER | 数量 | 代号 | 名称 | ... | 是否组装
10 | TS180-01Z-004 | 1 | TS180-01Z-004 | 中空立柱 | ... | [空]
20 | TS180-01Z-005 | 1 | TS180-01Z-005 | 四眼小板 | ... | [空]  
30 | GB_FASTENER_WASHER_SWMC6 | 4 | [空] | Plain Washer—Product Grade C | ... | [空]
40 | GB_FASTENER_BOLT_HHBFTC M6X20-N | 4 | [空] | Hexagon Head Bolt—Full Thread—Product Grade C | ... | [空]
50 | TS180-01Z-03Z | 1 | TS180-01Z-03Z | 滚珠轴承 | ... | 是
```

#### 预期输出文件
1. `TS180-01Z-01Z四柱平台.xls` - 顶层BOM导出
2. `TS180-01Z-02Z立柱平台.xls` - 子装配体BOM导出  
3. `TS180-01Z-01Z四柱平台_汇总.xls` - 最终汇总表
4. `TS180-01Z-01Z四柱平台_run.log` - 运行日志

## 测试步骤

### 步骤1：基础功能测试
1. 在SolidWorks中打开VBA编辑器
2. 将源码文件内容复制到对应模块
3. 运行`Main.RunExportNestedBOM`
4. 选择`TS180-01Z-01Z四柱平台.slddrw`
5. 检查输出文件是否正确生成

### 步骤2：BOM识别测试  
验证程序能否正确识别各列：
- 项目号列（DOCUMENT PREVIEW）
- 代号列（PART NUMBER）  
- 数量列（数量）
- 名称列（PART NAME）
- 是否组装列（最右侧）

### 步骤3：递归测试
1. 确认识别到"TS180-01Z-03Z"行的"是否组装"列为"是"
2. 验证程序尝试打开"TS180-01Z-03Z.slddrw"
3. 如果文件存在，检查是否正确递归处理
4. 如果文件不存在，检查日志中的警告信息

### 步骤4：数量统计测试
基于用户提供的汇总数据验证：
```
零件代号: TS180-01Z-003 四孔平板 -> 预期总数量: 1
零件代号: TS180-01Z-004 中空立柱 -> 预期总数量: 4  
零件代号: TS180-01Z-005 四眼小板 -> 预期总数量: 4
零件代号: GB_FASTENER_WASHER_SWMC 6 -> 预期总数量: 17
零件代号: GB_FASTENER_BOLT_HHBFTC M6X20-N -> 预期总数量: 18
零件代号: TS180-01Z-03Z 滚珠轴承 -> 预期总数量: 4
```

### 步骤5：汇总表验证
检查生成的汇总表是否包含：
1. 正确的表头结构
2. 所有底层零件（非装配体）
3. 正确的总数量计算
4. 详细的计算过程记录

## 错误测试

### 测试循环引用
1. 人为修改BOM，使A装配体包含B，B装配体包含A
2. 验证程序能否检测并提示循环引用

### 测试缺失文件
1. 删除或重命名子装配体工程图文件
2. 验证程序能否正确处理并记录警告

### 测试列识别失败
1. 修改BOM表头，使用非标准列名
2. 验证程序的默认列处理逻辑

## 性能测试

### 大型装配体测试
- 测试包含多层嵌套（接近10层限制）的装配体
- 验证递归深度控制是否正常工作
- 检查内存使用和处理速度

### 批量零件测试  
- 测试包含大量底层零件的装配体
- 验证汇总统计的准确性和性能

## 预期结果验证

### 文件生成检查
- [ ] Excel文件能否在未激活的Excel 2016中正常打开
- [ ] 缩略图是否正确嵌入
- [ ] 表格格式是否保持一致

### 数据准确性检查
- [ ] 底层零件总数量是否与手工计算一致
- [ ] 计算过程记录是否完整清晰
- [ ] 是否遗漏或重复计算零件

### 日志完整性检查  
- [ ] 关键操作是否都有日志记录
- [ ] 错误和警告信息是否详细明确
- [ ] 日志时间戳是否正确

## 故障排除

### 常见问题及解决方案
1. **BOM表识别失败**：检查工程图中的表格是否为标准BOM格式
2. **列定位错误**：查看日志中的列识别信息，必要时手动调整代码中的默认列位置
3. **文件路径问题**：确保所有相关文件在同一目录，文件名与代号完全一致
4. **权限问题**：确保对输出目录有写入权限

### 调试技巧
1. 启用VBA调试模式，逐步执行代码
2. 在关键位置添加`Debug.Print`输出中间变量
3. 使用`MsgBox`显示关键信息确认程序执行路径
4. 检查`Err.Number`和`Err.Description`获取详细错误信息

## 测试报告模板

### 基本信息
- 测试时间：
- 测试环境：SolidWorks版本、Windows版本
- 测试文件：使用的装配体文件名

### 测试结果
- [ ] 基础功能正常
- [ ] BOM识别准确  
- [ ] 递归处理正确
- [ ] 数量统计准确
- [ ] 汇总表生成正确
- [ ] 错误处理正常

### 发现问题
列出测试过程中发现的问题和改进建议

### 性能表现
记录处理时间、内存使用等性能指标

          
# 在VBA中使用Debug.Print进行调试

在VBA中，你可以使用`Debug.Print`语句在立即窗口(Immediate Window)中显示调试信息。这是一种非常有效的方式来跟踪代码执行过程和变量值，而不会影响最终用户体验。

## 基本语法

```vba
Debug.Print 表达式
```

其中，表达式可以是变量、字符串、数字或它们的组合。

## 在你的项目中使用Debug.Print的示例

### 1. 显示简单变量值

```vba
Dim partNo As String: partNo = "TS180-01Z-003"
Debug.Print "零件代号: " & partNo
```

### 2. 在ProcessBOMRows函数中跟踪列识别

```vba
Debug.Print "列识别结果："
Debug.Print "  数量列索引: " & colQty
Debug.Print "  代号列索引: " & colPartNumber
Debug.Print "  名称列索引: " & colName
Debug.Print "  是否组装列索引: " & colAssemble
Debug.Print "  项目号列索引: " & colItemNumber
```

### 3. 跟踪子装配体工程图查找过程

```vba
Dim childDrw As String
childDrw = FindDrawingByPartCode(GetFileFolder(drawingPath), partNo)
Debug.Print "查找子装配体工程图:"
Debug.Print "  零件代号: " & partNo
Debug.Print "  查找目录: " & GetFileFolder(drawingPath)
Debug.Print "  查找结果: " & IIf(Len(childDrw) > 0, childDrw, "未找到")
```

### 4. 跟踪递归过程和分解链

```vba
Debug.Print String(depth * 2, "-") & "> 处理装配体: " & GetFileNameNoExt(drawingPath)
Debug.Print String(depth * 2, " ") & "  当前分解链: " & currentChain
```

### 5. 跟踪汇总统计

```vba
Debug.Print "添加到汇总: " & partNo & ", 数量: " & qty & ", 分解链: " & chain
```

## 查看调试输出

1. 在SolidWorks VBA编辑器中，按下`Ctrl+G`打开立即窗口
2. 运行你的宏，Debug.Print的输出会显示在立即窗口中

## 调试技巧

1. **使用分隔符增强可读性**：
   ```vba
   Debug.Print String(50, "=")  ' 打印50个等号作为分隔线
   Debug.Print "开始处理新装配体"
   Debug.Print String(50, "=")
   ```

2. **条件调试**：只在特定条件下打印
   ```vba
   If depth > 3 Then Debug.Print "深层递归: " & depth & ", 路径: " & drawingPath
   ```

3. **格式化数字**：
   ```vba
   Debug.Print "总数量: " & Format(totalQty, "#,##0")
   ```

4. **输出对象信息**：
   ```vba
   Debug.Print "BOM表行数: " & ta.RowCount & ", 列数: " & ta.ColumnCount
   ```

将这些Debug.Print语句添加到你关心的代码位置，然后运行程序，就可以在立即窗口中看到执行过程和关键数据了。调试完成后，你可以保留这些语句（它们不会影响正常运行），或者删除/注释掉它们。
