使用AI生成SolidWorks工程图BOM清单导出Excel的VBA程序复盘

在过去一两周里，我和 AI 合作开发了一个用于将 SolidWorks 工程图的 BOM 清单导出为 Excel 表格的 VBA 程序。在这个过程中，我积累了一些经验和教训，所以在这里做一个复盘。  

首先，我想梳理一下整个流程。一开始，我在 Get 笔记里描述了我的需求，请 AI 帮我理清逻辑。AI 先通过语音帮我梳理思路，再转成文字并做了润色。接着，我把这个需求放到 flowith 的提示词生成框里，让 AI 帮我生成一个提示词框架，相当于为 AI 设定了角色。之后，我把我的中文需求贴在提示词框架的中间，留出需求部分，让 AI 来帮忙生成代码。  

当时用的可能是 O3 或 Cloud，具体记不太清了。AI 生成的代码肯定不是一次就能运行成功，所以我会让它一步步帮我完善，每次都和它交流，让它逐步调整。生成的代码我会贴到 Mac 电脑上的 Windows 虚拟机里，在 SolidWorks 里运行。过程中遇到各种问题，我会再回来让 AI 帮我修改。  

O3 的回答有时候比较慢，所以我会换一些响应更快的模型来帮我改代码。AI 还需要查阅之前的对话历史，找出它曾经帮我生成过的代码。  

但是，AI 并不能读取我当前已经修改过的代码，这其实是个问题。也就是说，在 flowith 里修改代码时，AI 只能根据对话历史进行调整，无法直接看到我最新的代码状态。  

后来我想起来，字节跳动推出了 TRAE 这个工具，于是我去下载试用。我输入的是 TRAE.cc 这个网址，而不是 .cn，所以进入的是国际版。国际版集成了各种国际通用的模型，而且不用翻墙也能用。不过，它会限制高速回答的次数。  

我本来想购买国际版会员，但用支付宝付款时，系统要求我提供一个美国地区的邮政编码来计算税率。我去网上咨询，有人告诉我国际版是收费的，而国内版不收费。国内版用的是国内的模型，比如 DeepSeek、通义千问等，成本比较低，所以可能就不收费了。  

不过，我还是想用全球公认最好的模型来完成我的任务，想看看这些顶级模型到底能做到什么程度。于是我最终还是买了一个月的国际版会员。  

在 TRAE 里，我和 AI 进行了多轮沟通，期间遇到了一些小问题，比如双引号处理、程序反复修改时变量未定义、函数重名等。由于有些变量和函数在不同地方都被定义过，来回修改后，代码量最终达到了 1225 行。  

当代码达到 1225 行时，我的虚拟机已经可以正常生成 Excel 表格了。它能够嵌套导出子装配的报表，并将这些数据汇总到顶层装配，作为一个工作簿里的多个工作表。  

随后，我请侯经理帮忙将代码上传到服务器，以便在生产环境的电脑上运行。但代码始终无法正常运行，系统总是提示“有一个程序正在运行”。我把报错截图和现象描述发给 Claude 和 GPT-5，请他们帮忙分析。Claude 的分析不太准确，后来 GPT-5 指出了问题的关键：可能是未激活的 Excel 2016 不断弹出激活窗口，导致无法正常打开文件。每次合并 Excel 表时，都会触发激活 Excel 的操作。GPT-5 建议我直接将文件保存为单个文件，而不是进行汇总，汇总工作可以后续在 Excel 中通过运行 VBA 宏来完成。我觉得这个建议可行。  

此外，我还让 Claude 4 帮我重构代码。Claude 4 很有信心地表示已经完成，并称将代码缩减了 37%，最终代码量降到了 800 多行。  

然而，代码缩减后，无论是在生产环境还是测试环境中，都无法正常运行，出现了各种 bug。经过一个周末的思考，我突然意识到，经过几轮与 AI 的交互，我对自己的需求和环境已经很了解。既然如此，为什么不重新生成一份需求说明，让 GPT-5 从头编写一套全新的代码呢？这样就不用在旧代码基础上反复修补了。因为编写新代码的成本相对较低，而不断修改旧代码则会浪费我宝贵的时间。  

在代码修改过程中还遇到了一些不愉快的情况。当我发现 Claude 4 修改得不对，要求它退回到之前的状态时，它理解的是 git 标记过的上一个状态，而不是我们上一轮对话之前的状态。这让我意识到，及时使用 git 记录改动并进行 commit 非常重要。  

关于让 GPT-5 从头生成代码，我在 Google 笔记中详细说明了需求，并让 AI 参考软件工程最佳实践整理了格式。最终生成了一份标准格式的需求文档，还列出了需要我补充信息的不清晰之处。  

补充信息后，这份文档变得较为完善。GPT-5 在生成代码时，注意到我使用了单独 doc 文件夹下的需求说明文档提出要求，而非直接粘贴在对话框里。我在对话框中也明确表示，请参考这份需求文档，按照软件工程最佳实践生成项目代码。  

GPT-5 经过分析，为自己列出一系列任务并逐步实施。他编写了各类记录文档，还专门为代码创建了一个文件夹。代码被拆分为几个模块文件，以实现低耦合、高聚合的目标。每个模块功能清晰，代码量适中，便于后续修改。  

生成文件后，GPT-5 根据我提供的测试环境信息生成了测试文档。我向他说明了测试用的 45 公里程序、泵表的截图以及希望生成的 BOM 表清单。由于我之前已经生成过，也告知了他最终总数的汇总计算方式。GPT-5 生成了测试文档并说明了部署方式。部署完成后，他让我直接进行整体功能测试。  

整体测试过程中发现两个主要问题。一是程序无法递归到子装配，只能生成顶层装配的清单；二是总体数量汇总的写法不够精简，我希望仅使用代号，无需附带名称。后来我发现自己能读懂程序，便直接让他修改。另一个问题是清单的总数汇总中出现汉字乱码。

此时需要明确检查生产环境和测试环境的差异。因为在测试环境通过后，我将程序整体打包传到生产环境，却遇到了上述问题。  

经分析，我发现程序在调用子装配时，对子装配名称的取法存在差异。它使用了 40 件号，而零件号可能被取成了我的代号。于是，我在生产环境中补充了零件号这一列，使程序能正确获取，而非用代号作为名称查找工程图，这样程序就能正确递归到子装配了。  

关于总数的计算，我与他沟通了两三轮，明确了总量的计算方式。只要逻辑清晰，他能够理解。有趣的是，乱码问题也通过这种方式得到了解决。  

我向他反馈乱码问题并请他提出解决方案。他提供了两三个方案，如声明使用 UTF 8 格式输出或更换其他输出格式。我表示不想频繁麻烦别人传代码，也不愿自己敲太多代码。因为之前他修改时添加了太多新代码，尤其是冗长的 HTML 代码，我懒得敲，所以确认时都拒绝了这些修改。  

后来，我问他是否有改动最小的解决办法。他给出的方案只需修改一行代码，我试了一下，导出的汇总清单果然不再出现乱码。至此，生产环境中的程序已能正常运行。  

其实还有一些其他测试需要进行，主要是防错测试。例如，当顶层装配、子装配甚至子装配的子装配发生递归调用时，程序能否及时报警；当子装配的工程图缺失时，程序是否会给出报警提示。因为工程图缺失时，计算总量可能会出错。我还没完成这些报警提示的测试，但既然已经要求他做这样的测试集，我就得去试试。  

此外，还需要进行递归深度的测试。目前递归层数设置为十层，我要测试超过十层后，程序是否会跳出并报警。  

通过这次合作，我总结了几点经验：  
首先，要用最好的模型处理最重要的工作。查找小代码、修改语法错误这类任务，可让反应快的模型来完成；而搭建架构、解决核心问题的工作，则不妨多等一会儿，交给最好的模型来做。  
其次，要清晰表达自己的需求。AI能理解我们的需求，但关键是我们要把需求和环境描述清楚。毕竟，最了解自己、环境和工具的人还是我们自己，AI无法代替我们猜测这些背景信息。  
另一个教训是，不要依赖对话式AI来修改程序。既然现在已有AI原生的编辑器，就没必要再用对话式AI改程序了。对话式AI可能更适合聊天和思想碰撞。  
此外，我的 TRAE 国际版会员只买了一个月。第一个月是3美元，下个月就要10美元了。我得记得及时取消下个月的自动续订，争取在这一个月内完成写程序和改程序的主要工作。以后用国内版就足够了。  
最后，我希望将这个小程序发布到GitHub上。因为里面的文档，包括项目说明文档、部署文档、测试文档和项目小结文档，都很完整，方便别人搜索和参考。  
不过，我要声明一下运行环境。别人可能无法直接借用，但稍作修改或许能减少一些工作量。虽然现在技术发达，别人可以直接用AI重新生成代码，我的代码也基本是AI帮忙生成的。这样反思一下，GitHub存在的意义是什么呢？如果很多代码都是AI生成的，分享这些代码的意义又何在？为什么不让AI直接重新生成代码，而非要用GitHub上已有的VBA程序呢？好，今天的复盘就先到这里。