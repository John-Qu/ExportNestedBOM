# 变更日志

本文记录近期的重要改动，便于追踪功能和行为差异。

2025-09（当前合作）
- 路径兼容性：将所有硬编码的“\”替换为 Application.PathSeparator，确保在 macOS/Windows 下路径枚举正常。
- 分表打印：新增 Run_Print_AllSheets_Separately，使页脚 &P 在每个工作表从 1 计数。
- 分表导出 PDF：新增 Run_Export_AllSheets_ToPDF，文件名仅用工作表名，保存到工作簿所在文件夹。
- 总 BOM 构建逻辑调整：从“遍历文件夹收集工作簿”改为“遍历当前合并后的工作簿工作表”，并新增 ExtractRowByKey 的 skipSheets 参数以排除“汇总”“总 BOM 清单”。
- 单表格式化增强：
  - 统一列标题（含别名清洗：如“材 料”→“材料”）。
  - 列序重排到标准序列。
  - 布尔列图标化（组/购/加/钣）。
  - 末尾无预览行清理：在图标化后，自动删除末尾连续的无预览行。
  - 备注列保障：若缺少“备注”且存在“零件名称”，在其前插入空白“备注”。
- 日志增强：在关键节点输出诊断信息（列索引识别、表头转储、删除行计数、插入列记录等），辅助生产排查。

已知问题与待办
- 预览判定目前基于形状/OLE 中心点落入单元格；若图片偏移可能误判。可升级为矩形相交判断。
- PDF 文件名非法字符需在 Utils 做集中清洗；当前由用户侧自行保证。
- 格式化流程的开关项（是否清理末尾/是否插入备注）可参数化，便于不同场景配置。