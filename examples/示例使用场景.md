# SolidWorks BOM自动化处理系统 - 示例使用场景

## 场景1：简单装配体处理

### 装配体结构
```
TS180-01Z-01Z 四柱平台 (顶层装配体)
├── TS180-01Z-003 四孔平板 (数量:1, 是否组装:否)
├── TS180-01Z-02Z 立柱平台 (数量:4, 是否组装:是)
│   ├── TS180-01Z-027 立柱平台 (数量:4, 是否组装:否)
│   └── GB_FASTENER_BOLT_HHBFTC M6X20-N (数量:2, 是否组装:否)
└── TS180-01Z-03Z 滚珠轴承 (数量:4, 是否组装:否)
```

### 期望输出

#### 1. 中间BOM文件
- `TS180-01Z-01Z.xls` - 顶层装配体BOM
- `TS180-01Z-02Z.xls` - 立柱平台子装配体BOM

#### 2. 汇总表 (`TS180-01Z-01Z_汇总.xls`)
| 代号 | 名称 | 总数量 | 分解链 |
|------|------|--------|--------|
| TS180-01Z-003 | 四孔平板 | 1 | TS180-01Z-01Z#1: 1 => 1 |
| TS180-01Z-027 | 立柱平台 | 16 | TS180-01Z-02Z#2: 4 x 4 => 16 |
| GB_FASTENER_BOLT_HHBFTC M6X20-N | 螺栓 | 8 | TS180-01Z-02Z#3: 2 x 4 => 8 |
| TS180-01Z-03Z | 滚珠轴承 | 4 | TS180-01Z-01Z#4: 4 => 4 |

## 场景2：多层嵌套装配体

### 装配体结构
```
主装配体
├── 子装配体A (数量:2)
│   ├── 子装配体A1 (数量:3)
│   │   ├── 零件A1-1 (数量:4)
│   │   └── 零件A1-2 (数量:2)
│   └── 零件A-2 (数量:1)
├── 子装配体B (数量:1)
│   ├── 零件B-1 (数量:6)
│   └── 零件B-2 (数量:3)
└── 零件C (数量:5)
```

### 数量计算逻辑

#### 零件A1-1总数量计算：
- 在子装配体A1中：4个
- 子装配体A1在子装配体A中：3个
- 子装配体A在主装配体中：2个
- **总数量 = 4 × 3 × 2 = 24个**

#### 零件A1-2总数量计算：
- 在子装配体A1中：2个
- 子装配体A1在子装配体A中：3个  
- 子装配体A在主装配体中：2个
- **总数量 = 2 × 3 × 2 = 12个**

### 期望汇总表
| 代号 | 名称 | 总数量 | 分解链 |
|------|------|--------|--------|
| 零件A1-1 | 零件A1-1 | 24 | 子装配体A1#1: 4 x 3 x 2 => 24 |
| 零件A1-2 | 零件A1-2 | 12 | 子装配体A1#2: 2 x 3 x 2 => 12 |
| 零件A-2 | 零件A-2 | 2 | 子装配体A#3: 1 x 2 => 2 |
| 零件B-1 | 零件B-1 | 6 | 子装配体B#1: 6 x 1 => 6 |
| 零件B-2 | 零件B-2 | 3 | 子装配体B#2: 3 x 1 => 3 |
| 零件C | 零件C | 5 | 主装配体#5: 5 => 5 |

## 场景3：包含标准件的装配体

### 装配体结构（基于测试文件）
```
TS180-01Z-01Z 四柱平台
├── TS180-01Z-003 四孔平板 (数量:1)
├── TS180-01Z-004 中空立柱 (数量:1) 
├── TS180-01Z-005 凹眼小板 (数量:4)
├── GB_FASTENER_WASHER_SWMC 6 垫圈 (数量:4)
├── GB_FASTENER_BOLT_HHBFTC M6X20-N 螺栓 (数量:4)
└── TS180-01Z-03Z 滚珠轴承 (数量:1, 是否组装:是)
    └── TS180-01Z-03Z 滚珠轴承内部零件 (数量:4)
```

### BOM表特征
- 包含中英文混合列名
- 标准件使用长代号
- 零件名称包含规格信息
- "是否组装"列在最右侧

### 处理结果
1. **自动识别列名**：程序能识别"数量"、"PART NUMBER"、"PART NAME"等列
2. **标准件处理**：长代号的GB标准件正确统计
3. **递归处理**：正确处理滚珠轴承子装配体
4. **图片保存**：BOM中的零件缩略图正确导出

## 场景4：异常情况处理

### 4.1 循环引用检测
```
装配体A
├── 子装配体B
│   └── 装配体A (循环引用！)
```
**系统响应**：
- 弹出对话框："检测到循环引用：装配体A"
- 在日志中记录循环引用信息
- 停止当前递归分支，继续处理其他分支

### 4.2 递归深度超限
```
层级1 -> 层级2 -> ... -> 层级10 -> 层级11 (超限！)
```
**系统响应**：
- 日志记录："递归深度超限 (>10)：层级11文件路径"
- 自动停止递归，不影响其他分支处理

### 4.3 文件缺失
```
主装配体.slddrw
├── 存在的子装配体.slddrw ✓
└── 缺失的子装配体.slddrw ✗
```
**系统响应**：
- 日志警告："未找到子装配体工程图：缺失的子装配体.slddrw"
- 跳过缺失文件，继续处理其他部分

## 场景5：大型装配体性能测试

### 测试规格
- **装配体层级**：8层
- **总零件数**：500+个
- **子装配体数**：50+个
- **文件总数**：100+个

### 性能指标
- **处理时间**：< 5分钟
- **内存使用**：< 1GB
- **输出文件**：
  - 50+ 个独立BOM Excel文件
  - 1个汇总表（包含所有底层零件）
  - 1个详细日志文件

### 优化措施
1. **内存管理**：及时释放SolidWorks文档对象
2. **文件操作**：批量处理，减少频繁的文件开关
3. **日志轮转**：超过5MB自动重置日志文件
4. **错误恢复**：单个文件处理失败不影响整体流程

## 使用建议

### 1. 文件准备
- 确保所有工程图文件在同一目录
- 检查BOM表格式的一致性
- 备份重要文件

### 2. 运行前检查
- 关闭不必要的SolidWorks文档
- 确保足够的硬盘空间
- 检查文件写权限

### 3. 结果验证
- 检查生成的Excel文件
- 验证汇总表数量的准确性
- 查看日志文件了解处理详情

### 4. 问题排查
- 查看详细日志文件
- 检查文件路径和权限
- 验证BOM表格式