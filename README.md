# SolidWorks BOM自动化处理系统

**当前稳定版本：v1.0（发布日期：2024-07-28）**

## 项目简介

基于SolidWorks 2019 VBA开发的BOM清单递归导出、零件数量递归统计及汇总表生成工具，满足生产环境中对装配体层级结构拆解、零件用量核算的自动化需求。

## 主要功能

1. **BOM递归导出**：自动识别装配体层级关系，递归导出各级BOM表为Excel文件（含缩略图）
2. **数量统计**：精确计算底层零件在整个装配体中的总数量（支持多层嵌套乘积）
3. **汇总表生成**：生成包含所有底层零件总数量和计算过程的汇总表

## 系统要求

- Windows 10专业版
- SolidWorks 2019
- 支持未激活的Excel 2016（使用SolidWorks内置导出，避免Excel COM依赖）

## 安装与使用

### 方法一：SolidWorks宏编辑器
1. 打开SolidWorks 2019
2. 菜单栏：工具 → 宏 → 编辑
3. 在VBA编辑器中：
   - 插入 → 模块，分别创建 Main、RecursiveProcessor、Utils、Logger 四个模块
   - 将对应的`.bas`文件内容复制粘贴到各模块中
4. 按F5运行`Main.RunExportNestedBOM`

### 方法二：导入宏文件
1. 将整个`src`文件夹复制到SolidWorks可访问的位置
2. 在SolidWorks中：工具 → 宏 → 运行
3. 选择`Main.bas`并运行`RunExportNestedBOM`函数

## 使用说明

### 文件结构要求
- 所有相关的工程图文件(.slddrw)必须在同一文件夹
- 子装配体工程图命名规则：`[子装配体代号].slddrw`
- 例如：代号为"TS180-01Z-02Z"的子装配体，对应工程图为"TS180-01Z-02Z.slddrw"

### BOM表格式要求
程序会自动识别以下列：
- **数量列**：支持"数量"、"QTY"、"Qty"等
- **代号列**：支持"代号"、"PART NUMBER"、"Part Number"等
- **名称列**：支持"名称"、"PART NAME"、"Name"等  
- **是否组装列**：支持"是否组装"、"Is Assembly"、"组装"等，值为"是"/"Yes"/"Y"/"True"/"1"表示子装配体

### 运行流程
1. 运行宏后会弹出文件选择对话框
2. 选择顶层装配体工程图(.slddrw文件)
3. 程序自动：
   - 导出各级BOM表为Excel文件
   - 计算底层零件总数量
   - 生成汇总表：`[顶层装配体名称]_汇总.xls`

### 输出文件
- **各级BOM**: `[装配体名称].xls`（包含缩略图）
- **汇总表**: `[顶层装配体名称]_汇总.xls`（包含计算过程）
- **日志文件**: `[顶层装配体名称]_run.log`

## 测试案例

项目包含基于实际装配体的测试案例：
- 顶层：TS180-01Z-01Z 四柱平台
- 子装配体：TS180-01Z-02Z 立柱平台  
- 底层零件：各种标准件和自制件

## 技术特点

- **兼容性**：避免Excel COM依赖，使用SolidWorks内置导出
- **健壮性**：循环引用检测、递归深度控制（最大10层）
- **可追溯性**：详细的计算过程记录和日志输出
- **容错性**：智能列识别，缺失列时提供默认处理

## 故障排除

### 常见问题
1. **"未找到BOM表"**: 确保工程图包含BOM表且表格类型为"BomFeat"
2. **"未找到子装配体工程图"**: 检查子装配体工程图文件名是否与BOM中代号一致
3. **"循环引用"**: 检查装配体结构，避免A包含B，B又包含A的情况
4. **"列识别失败"**: 检查日志文件，程序会尝试默认列位置

### 日志查看
程序运行过程中会生成详细日志，位置：`[工程图文件夹]\[装配体名称]_run.log`

## 项目结构

```
ExportNestedBOM/
├── src/                           # VBA源码文件
│   ├── Main.bas                  # 主入口模块
│   ├── RecursiveProcessor.bas    # 递归处理核心逻辑
│   ├── Utils.bas                 # 工具函数
│   ├── Logger.bas                # 日志记录
│   ├── Constants.bas             # 系统常量定义
│   ├── Configuration.bas         # 配置管理模块
│   └── ExportNestedBOM.swp       # SolidWorks宏项目文件
├── test/                          # 测试相关文件
│   ├── 测试指南.md               # 详细测试说明
│   └── 单元测试模拟.bas           # 单元测试代码
├── doc/                           # 项目文档
│   └── SolidWorks BOM自动化处理系统需求规格说明书.md
├── deploy/                        # 部署相关文档
│   └── 部署说明.md               # 安装和部署指南
├── examples/                      # 示例和使用场景
│   └── 示例使用场景.md           # 详细使用示例
└── README.md                      # 项目说明文档
```

## 开发者信息

本项目采用软件工程最佳实践：
- 模块化设计，职责分离
- 完整的错误处理和日志记录
- 详细的代码注释和文档
- 基于实际测试数据的验证

## 最近更新

### v1.0 (2024-07-28)
- 修复生产环境汇总表中文乱码问题（HTML输出编码改为gb2312）
- 支持"代号 名称.slddrw"格式的工程图文件查找
- BOM列识别支持"零件号"作为代号列关键词
- 优化错误处理和日志记录

## 贡献与反馈

欢迎通过GitHub Issues提交问题反馈或功能建议。如需贡献代码，请提交Pull Request。

## 许可证

本项目采用MIT许可证。详见LICENSE文件。

本项目仅供学习和研究使用。